<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  importlib.metadata | axju
</title>
        <meta name="author" content="Axel Juraske" />
        <meta name="keywords" content="python" />
        <meta name="description" content="I didn&#39;t notice that pkg_resources was replaced by importlib.metadata from the standard library" />
  <link rel="canonical" href="https://axju.github.io/posts/2021/04/importlibmetadata/index.html">


  <link rel="stylesheet" href="https://axju.github.io/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://axju.github.io/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://axju.github.io/theme/css/pygments/native.min.css">
  <link rel="stylesheet" href="https://axju.github.io/theme/css/theme.css">
  <link rel="stylesheet" href="https://axju.github.io/theme/css/main.css">
  <link rel="stylesheet" href="https://axju.github.io/theme/css/purecookie.css" async />
  <script src="https://axju.github.io/theme/js/purecookie.js" async></script>

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://axju.github.io/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://axju.github.io/feeds/python.atom.xml">  <script async src="https://www.googletagmanager.com/gtag/js?id=G-W0RC1HYD7Y"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W0RC1HYD7Y');
  </script>


</head>

<body>
<a href="https://github.com/axju">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="https://axju.github.io/">
        <img class="img-fluid rounded" src=https://axju.github.io/images/logo.png alt="axju">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="https://axju.github.io/">axju</a></h1>
      <p class="text-muted">Just coding stuff</p>
      <ul class="list-inline">
            <li class="list-inline-item"><a href="https://axju.github.io/pages/projects/">Projects</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/axju" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-youtube" href="https://www.youtube.com/channel/UCFFrfCiHAh0gaQvGZBYMsuA" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-instagram" href="https://www.instagram.com/axju.py/" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-twitter" href="https://twitter.com/0xAxJu" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  importlib.metadata
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2021-04-26T20:15:00+02:00">
          <i class="fas fa-clock"></i>
          Mon 26 April 2021
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="https://axju.github.io/category/python.html">python</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="https://axju.github.io/tag/python.html">#python</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>Module <a class="reference external" href="https://docs.python.org/3/library/importlib.metadata.html">importlib.metadata</a> has been around since Python version 3.8. And that make <strong>pkg_resources</strong> some kind of deprecated.
I personally uses <strong>pkg_resources</strong> on two places and didn't realize that it was out of date.</p>
<ol class="arabic simple">
<li>To load some entry point, if I build a pluggable package.</li>
<li>Get the version number at runtime, if I uses setuptools-scm.</li>
</ol>
<p>Maybe in different places, but these two pop up in my head first.
There is also a <a class="reference external" href="https://pypi.org/project/importlib-metadata/">package</a> that supplies backports of functionality for Python version smaller then 3.8</p>
<div class="section" id="load-entry-points">
<h2>Load entry points</h2>
<p>The Python setup script provides entry points where objects can be assigned.
In your main package, you can search for specific entry points and load them.
Other package can also defined this entry point, so your main package will load them too.
If you are interesting, I make a <a class="reference external" href="https://youtu.be/Po5JaNVgo-M">small video</a>. Unfortunately, this video uses the old <strong>pkg_resources</strong> module.</p>
<p>With <strong>importlib.metadata</strong>, the new one:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">importlib.metadata</span> <span class="kn">import</span> <span class="n">entry_points</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">enp</span> <span class="ow">in</span> <span class="n">entry_points</span><span class="p">()[</span><span class="s1">&#39;axju.commands&#39;</span><span class="p">]:</span>
<span class="o">...</span>   <span class="nb">print</span><span class="p">(</span><span class="n">enp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">django</span>
<span class="n">info</span>
<span class="n">show</span>
</pre></div>
<p>The old one with <strong>pkg_resources</strong>:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">iter_entry_points</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">enp</span> <span class="ow">in</span> <span class="n">iter_entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;axju.commands&#39;</span><span class="p">):</span>
<span class="o">...</span>   <span class="nb">print</span><span class="p">(</span><span class="n">enp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">django</span>
<span class="n">info</span>
<span class="n">show</span>
</pre></div>
</div>
<div class="section" id="retrieving-package-version-at-run-time">
<h2>Retrieving package version at run time</h2>
<p>You can find this example on the readme file from <strong>setuptools-scm</strong>.</p>
<p>This is how you should do it, with <strong>importlib.metadata</strong>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">importlib.metadata</span> <span class="kn">import</span> <span class="n">version</span><span class="p">,</span> <span class="n">PackageNotFoundError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="s2">&quot;package-name&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">PackageNotFoundError</span><span class="p">:</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
</pre></div>
<p>And you'd better avoid that:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">get_distribution</span><span class="p">,</span> <span class="n">DistributionNotFound</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="n">get_distribution</span><span class="p">(</span><span class="s2">&quot;package-name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>
<span class="k">except</span> <span class="n">DistributionNotFound</span><span class="p">:</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
</pre></div>
<p>However, this does place a runtime dependency on <strong>setuptools</strong> and can add up
to a few 100ms overhead for the package import time.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>As you can see, these are not major changes to the source code.
So the problem are not the adjustments, but the fact you should read the release note.
Shame on me, I don't read them very often. I only came across this while researching for my video. But even then I did get it after the video it was published.</p>
<p>The biggest source for my video was the <a class="reference external" href="https://amir.rachum.com/blog/2017/07/28/python-entry-points/">post</a> from Amir Rachum's Blog, which was written before the release of version 3.8. That's why he still used <strong>pkg_resources</strong>.</p>
<div class="section" id="memo-to-myself-read-the-release-note">
<h3>Memo to myself, read the release note</h3>
</div>
</div>

    </div>
  </article>
  <hr>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function() {
      this.page.url = 'https://axju.github.io/posts/2021/04/importlibmetadata/index.html';
      this.page.identifier = 'importlibmetadata';
    };
    (function() {
      var d = document;
      var s = d.createElement('script');
      s.src = '//axju.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript class="text-muted">
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://axju.github.io/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://axju.github.io/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://axju.github.io/tags.html">Tags</a></li>

      <li class=" list-inline-item text-muted">|</li>
    <li class="list-inline-item"><a class="fas fa-rss" href="https://axju.github.io/feeds/all.atom.xml" target="_blank"></a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Last update: 2021-08-02
  </p>
</div>    </div>
  </footer>

</body>

</html>